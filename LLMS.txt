# Umara

> Beautiful Python UI framework for building web applications without HTML, CSS, or JavaScript.

## Installation

```bash
pip install umara
```

## Quick Start

```python
import umara as um

um.set_theme('ocean')
um.header('My App')

# IMPORTANT: Use forms for input + button patterns
with um.form('greeting_form'):
    name = um.input('Your name')
    if um.form_submit_button('Greet'):
        um.success(f'Hello, {name}!')
```

Run: `umara run app.py`
Open: http://localhost:8501

---

## CRITICAL PATTERNS

### Pattern 1: Input + Button (USE FORMS!)

**WRONG** - Button may fire before input value is synced (50ms debounce):
```python
# DON'T DO THIS - race condition possible
name = um.input('Name', key='name')
if um.button('Submit'):
    um.success(f'Hello {name}')  # name might be stale!
```

**CORRECT** - Form batches values and submits together:
```python
# DO THIS - values guaranteed to be current
with um.form('my_form'):
    name = um.input('Name')
    email = um.input('Email')
    if um.form_submit_button('Submit'):
        um.success(f'Submitted: {name}, {email}')
```

### Pattern 2: Real-time Updates (Standalone + Key)

Use standalone inputs with `key` only for real-time filtering/search:
```python
# Good for search - updates on every keystroke
search = um.input('Search', key='search_query')
filtered = [item for item in items if search.lower() in item.lower()]
for item in filtered:
    um.text(item)
```

### Pattern 3: Toggle/Checkbox Immediate Effect

```python
dark_mode = um.toggle('Dark mode', key='dark_mode')
if dark_mode:
    um.set_theme('dark')
else:
    um.set_theme('light')
```

### When to Use What

| Scenario | Solution |
|----------|----------|
| Input + submit button | `um.form()` + `um.form_submit_button()` |
| Multi-field data entry | `um.form()` |
| Real-time search/filter | Standalone input with `key` |
| Toggle/checkbox immediate effect | Standalone with `key` |

---

## API Reference

### Typography
```python
um.title('Page Title')
um.header('Section Header')
um.subheader('Subsection')
um.text('Regular text')
um.caption('Small caption text')
um.markdown('**bold** and *italic*')
um.code('print("hello")', language='python')
um.latex(r'E = mc^2')
```

### Input Components

All inputs return their current value. Use `key` parameter for persistence.

```python
# Text input
text = um.input(
    label='',
    key=None,           # State key for persistence
    value='',           # Default value
    placeholder='',
    type='text',        # 'text', 'password', 'email', 'number'
    disabled=False,
    label_position='top',  # 'top' or 'left'
    label_width='120px'    # Width when label_position='left'
)

# Multi-line text
text = um.text_area(label='', key=None, value='', placeholder='', rows=4)

# Number input
num = um.number_input(
    label='',
    min_value=None,
    max_value=None,
    value=0,
    key=None,
    step=1
)

# Slider
num = um.slider(label='', min_value=0, max_value=100, value=None, key=None, step=1)

# Select dropdown
choice = um.select(
    label='',
    options=['A', 'B', 'C'],  # List of strings or dicts
    key=None,
    default=None,
    placeholder='Select an option...'
)

# Multi-select
choices = um.multiselect(label='', options=[], key=None, default=[])

# Radio buttons
option = um.radio(label='', options=['S', 'M', 'L'], key=None, default=None, horizontal=False)

# Checkbox (returns bool)
checked = um.checkbox(label='', key=None, value=False)

# Toggle switch (returns bool)
enabled = um.toggle(label='', key=None, value=False)

# Date picker (returns string)
date = um.date_input(label='', key=None, value=None)

# Time picker (returns string)
time = um.time_input(label='', key=None, value=None)

# Color picker (returns hex string)
color = um.color_picker(label='', key=None, value='#6366f1')

# Star rating (returns int)
stars = um.rating(label='', key=None, value=0, max_value=5)

# File upload (returns file dict or None)
file = um.file_uploader(
    label='',
    key=None,
    accept=['.csv', '.pdf'],  # File types
    multiple=False,
    max_file_size=10*1024*1024  # bytes
)
```

### Buttons
```python
# Click button (returns True when clicked)
if um.button(
    label='Click me',
    key=None,
    variant='primary',  # 'primary', 'secondary', 'outline', 'ghost', 'danger'
    disabled=False,
    loading=False,      # Shows spinner, disables button
    full_width=False
):
    um.success('Clicked!')

# Download button
um.download_button(
    label='Download',
    data='file content',     # str, bytes, or callable
    file_name='data.csv',
    mime=None,               # Auto-detected from filename
    variant='secondary'
)

# Link button
um.link_button(label='Go to Google', url='https://google.com')
```

### Forms
```python
with um.form(
    key='my_form',
    clear_on_submit=False,  # Clear values after submit
    border=True             # Show border around form
):
    name = um.input('Name')
    email = um.input('Email')

    if um.form_submit_button(label='Submit', variant='primary'):
        # All values guaranteed to be current here
        um.success(f'Got: {name}, {email}')
```

### Layouts
```python
# Columns
with um.columns(3):  # Number of columns
    with um.column():
        um.text('Column 1')
    with um.column():
        um.text('Column 2')
    with um.column():
        um.text('Column 3')

# Grid
with um.grid(columns=4, gap='16px'):
    for i in range(8):
        um.text(f'Item {i}')

# Card
with um.card(title='Card Title', subtitle='Optional subtitle'):
    um.text('Card content')

# Tabs
with um.tabs(['Tab 1', 'Tab 2']) as t:
    with t.tab(0):
        um.text('Content for tab 1')
    with t.tab(1):
        um.text('Content for tab 2')

# Sidebar
with um.sidebar():
    um.header('Navigation')
    um.text('Sidebar content')

# Expander (collapsible)
with um.expander('Click to expand', expanded=False):
    um.text('Hidden content')

# Modal dialog
if um.button('Open Modal'):
    um.open_modal('my_modal')

with um.modal('Dialog Title', key='my_modal'):
    um.text('Modal content')
    if um.button('Close'):
        um.close_modal('my_modal')
```

### Data Display
```python
um.metric(label='Users', value='12,543', delta=12.5)  # With trend indicator
um.progress(value=75, label='Completion')
um.dataframe(data, sortable=True)  # Works with pandas DataFrames
um.json_viewer({'key': 'value'})
um.badge('New', variant='success')  # success, warning, error, info
um.avatar(name='John Doe')  # Shows initials
um.avatar(src='https://example.com/photo.jpg', size='lg')  # sm, md, lg, xl
um.divider()
um.spacer(height='24px')
```

### Navigation
```python
um.breadcrumbs([
    {'label': 'Home', 'href': '/'},
    {'label': 'Products', 'href': '/products'},
    {'label': 'Detail'}
])

um.steps(['Cart', 'Shipping', 'Payment', 'Confirm'], current=1)
page = um.pagination(total_pages=10, current_page=1, key='page')
```

### Feedback
```python
um.success('Done!')
um.error('Failed')
um.warning('Caution')
um.info('Note')
um.toast('Quick notification', icon='âœ…', duration=4000)

# Loading spinner (context manager)
with um.spinner('Processing...'):
    result = slow_function()

# Exception display
try:
    risky_operation()
except Exception as e:
    um.exception(e)

# Force rerun
um.rerun()
```

### Media
```python
um.image(src='https://example.com/img.png', caption='Photo', width='300px')
um.video(src='video.mp4', autoplay=False, controls=True)
um.audio(src='audio.mp3', controls=True)
```

### State Management
```python
# Persist data across reruns
um.session_state.setdefault('counter', 0)
um.session_state.counter += 1

# Both notations work:
um.session_state.counter = 5
um.session_state['counter'] = 5
```

### Themes
```python
# 12 built-in themes
um.set_theme('light')     # default
um.set_theme('dark')      # dark mode
um.set_theme('ocean')     # blues
um.set_theme('forest')    # greens
# Also: slate, nord, midnight, rose, copper, lavender, sunset, mint

# Custom theme
my_theme = um.create_theme('my_theme', base='light',
    colors={'primary': '#ff6b6b', 'secondary': '#4ecdc4'})
um.set_theme(my_theme)
```

### Page Configuration
```python
um.set_page_config(
    page_title='My App',
    page_icon='ðŸ“Š',
    layout='wide',  # 'centered' or 'wide'
    initial_sidebar_state='auto'  # 'auto', 'expanded', 'collapsed'
)
```

### Custom Styling
```python
my_style = um.style(
    color='#ff0000',
    fontSize='18px',
    padding='16px',
    backgroundColor='#f0f0f0',
    borderRadius='8px'
)
um.text('Styled text', style=my_style)
```

### Chat Interface
```python
um.session_state.setdefault('messages', [])

with um.chat_container(height='400px'):
    for msg in um.session_state.messages:
        um.chat_message(msg['content'], role=msg['role'])

user_input = um.chat_input('Type message...')
if user_input:
    um.session_state.messages.append({'role': 'user', 'content': user_input})
    # Add AI response here
```

### Charts
```python
data = [{'month': 'Jan', 'value': 100}, {'month': 'Feb', 'value': 200}]
um.line_chart(data, x='month', y='value')
um.bar_chart(data, x='month', y='value')
um.area_chart(data, x='month', y='value')
um.pie_chart(data, label='month', value='value')
um.scatter_chart(data, x='month', y='value')

# Plotly charts
import plotly.express as px
fig = px.scatter(df, x='x', y='y', color='category')
um.plotly_chart(fig)
```

### Caching
```python
@um.cache_data  # Cache function results forever
def load_data():
    return pd.read_csv('large.csv')

@um.cache_data(ttl=3600)  # Cache for 1 hour
def fetch_api_data(url):
    return requests.get(url).json()

@um.cache_resource  # Cache connections/models (shared across users)
def get_db():
    return sqlite3.connect('app.db')
```

### Fragments (Partial Reruns)
```python
@um.fragment
def chart_section():
    points = um.slider('Points', 10, 100, 50, key='points')
    um.line_chart(generate_data(points))

@um.fragment(run_every=5)  # Auto-refresh every 5 seconds
def live_metrics():
    data = fetch_live_data()
    um.metric('Active Users', data['users'])

# Use in app
chart_section()
live_metrics()
```

### Database & API Connections
```python
# SQL database
conn = um.connection.sql('mydb', url='sqlite:///data.db')
users = conn.query('SELECT * FROM users WHERE age > ?', params=(18,))
conn.execute('INSERT INTO users (name) VALUES (?)', params=('Alice',))

# HTTP/REST API
api = um.connection.http(
    'github',
    base_url='https://api.github.com',
    headers={'Authorization': f'token {token}'},
    timeout=30
)
repos = api.get('/users/octocat/repos')
api.post('/endpoint', json={'key': 'value'})
```

---

## Common Examples

### Contact Form
```python
import umara as um

um.header('Contact Us')

with um.card():
    with um.form('contact'):
        name = um.input('Name')
        email = um.input('Email', type='email')
        message = um.text_area('Message', rows=5)

        if um.form_submit_button('Send Message'):
            if not all([name, email, message]):
                um.error('Please fill all fields')
            else:
                um.success('Message sent!')
```

### Dashboard
```python
import umara as um

um.set_theme('dark')
um.header('Dashboard')

with um.columns(4):
    with um.column():
        um.metric('Users', '12,543', delta=12.5)
    with um.column():
        um.metric('Revenue', '$48.2K', delta=8.2)
    with um.column():
        um.metric('Sessions', '1,892', delta=-2.4)
    with um.column():
        um.metric('Conversion', '3.24%', delta=0.5)

um.line_chart(data, x='date', y='value')
um.dataframe(recent_orders, sortable=True)
```

### Search with Live Filtering
```python
import umara as um

items = ['Apple', 'Banana', 'Cherry', 'Date', 'Elderberry']

# Real-time search - use key, no form needed
search = um.input('Search fruits', key='search')

filtered = [item for item in items if search.lower() in item.lower()]

for item in filtered:
    um.text(f'â€¢ {item}')
```

### Settings with Immediate Effect
```python
import umara as um

with um.sidebar():
    um.header('Settings')
    dark = um.toggle('Dark mode', key='dark_mode')
    show_details = um.checkbox('Show details', key='show_details')

if dark:
    um.set_theme('dark')

um.header('Content')
um.text('Main content here')

if show_details:
    with um.expander('Details', expanded=True):
        um.text('Extra information...')
```

---

## CLI Commands

```bash
umara run app.py              # Run app
umara run app.py --port 8080  # Custom port
umara init my_project         # Create new project
umara themes                  # List themes
```

## Documentation

Full API: docs/UMARA_COMPLETE_REFERENCE.md
GitHub: https://github.com/lhassa8/umara
PyPI: https://pypi.org/project/umara/
